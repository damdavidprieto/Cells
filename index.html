<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cells - Simulador de Evoluci칩n</title>
    <!-- Error Handler -->
    <script>
        window.onerror = function (msg, url, lineNo, columnNo, error) {
            const message = [
                'Message: ' + msg,
                'URL: ' + url,
                'Line: ' + lineNo,
                'Column: ' + columnNo,
                'Error object: ' + JSON.stringify(error)
            ].join(' - ');

            // Create visible error banner
            const div = document.createElement('div');
            div.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; background: red; color: white; padding: 20px; z-index: 9999; font-family: monospace; font-size: 16px; white-space: pre-wrap; margin: 20px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.5);';
            div.textContent = 'CRITICAL ERROR: ' + message;
            document.body.appendChild(div);

            console.error('Window Error:', message);
            return false;
        };
        window.addEventListener('unhandledrejection', function (event) {
            const div = document.createElement('div');
            div.style.cssText = 'position: fixed; bottom: 0; left: 0; right: 0; background: orange; color: black; padding: 20px; z-index: 9999; font-family: monospace; font-size: 16px; white-space: pre-wrap; margin: 20px; border-radius: 8px;';
            div.textContent = 'UNHANDLED PROMISE: ' + event.reason;
            document.body.appendChild(div);
            console.error('Unhandled Rejection:', event.reason);
        });
    </script>
    <link rel="stylesheet" href="style.css?v=2">
    <link rel="icon" href="favicon.ico" type="image/x-icon">

    <!-- Librer칤a Gr치fica (p5.js) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
</head>

<body>
    <!-- Contenedor del Canvas (Juego) -->
    <div id="canvas-container"></div>

    <!-- Contenedor Ra칤z para la Interfaz (UI) -->
    <!-- Los componentes inyectar치n su HTML aqu칤 dentro -->
    <div id="ui-root"></div>

    <!-- ========================================== -->
    <!--            CARGA DE SCRIPTS                -->
    <!-- ========================================== -->

    <!-- 1. Configuraci칩n Global -->
    <!-- 1. Configuraci칩n Global -->
    <script>
        document.write('<script src="src/utils/Constants.js?v=' + Date.now() + '"><\/script>');
    </script>

    <!-- 2. Utilidades y Logs -->
    <!-- 2. Dynamic Script Loader (Cache Buster) -->
    <script>
        const scripts = [
            // Utils & Logging
            'src/logging/AnomalyDetector.js', // Sanitizer
            // Modular Database Logging
            'src/logging/db/DBConfig.js',
            'src/logging/db/DBSchema.js',
            'src/logging/db/DBWriter.js',
            'src/logging/db/DBExporter.js',
            'src/logging/db/DatabaseManager.js',

            // DNA & Genetics
            'src/dna/DNAFactory.js',
            'src/dna/DNAMutator.js',
            'src/dna/GeneticDistance.js',
            'src/dna/GeneticTranslation.js',

            // Organelles
            'src/organelles/Organelle.js',
            'src/organelles/Ribosome.js',
            'src/organelles/Flagellum.js',
            'src/organelles/Hydrogenosome.js',
            'src/organelles/ChemosyntheticEnzymes.js',

            // Chemistry System
            'src/chemistry/core/ElementCategories.js',
            'src/chemistry/core/Element.js',
            'src/chemistry/core/PeriodicTable.js',
            'src/chemistry/data/elements/elements_001_020.js',
            'src/chemistry/data/elements/elements_021_040.js',
            'src/chemistry/data/elements/elements_041_060.js',
            'src/chemistry/molecules/Molecule.js',
            'src/chemistry/data/molecules.js',
            'src/chemistry/molecules/Reaction.js',
            'src/chemistry/data/reactions.js',
            'src/chemistry/bio/Protein.js',
            'src/chemistry/bio/Enzyme.js',
            'src/chemistry/data/enzymes.js',
            'src/chemistry/bio/Proteome.js',
            'src/chemistry/molecules/MolecularSystem.js',
            'src/chemistry/ChemistrySystem.js',

            // Cellular Systems
            'src/cellular_systems/FlagellaCosts.js',
            'src/cellular_systems/MetabolicCosts.js',
            'src/cellular_systems/ResourceConsumption.js',
            'src/cellular_systems/MembraneSystem.js',
            'src/cellular_systems/ColorSystem.js',
            'src/cellular_systems/OxygenTolerance.js',
            'src/cellular_systems/ThermalStress.js',
            'src/cellular_systems/ChemotaxisSystem.js',
            'src/reproduction/ReproductionSystem.js',

            // Visualization
            'src/visualization/CellRenderer.js',
            'src/visualization/SpeciesNotifier.js',

            // Ecosystem
            'src/ecosystem/utils/GridUtils.js',
            'src/ecosystem/grids/ResourceGrids.js',
            'src/ecosystem/grids/ChemicalGrids.js',
            'src/ecosystem/grids/PhysicalGrids.js',
            'src/ecosystem/WorldConfig.js',
            'src/ecosystem/WorldPresets.js',
            'src/ecosystem/vents/VentTypes.js',
            'src/ecosystem/vents/VentLifecycle.js',
            'src/ecosystem/vents/VentPlume.js',
            'src/ecosystem/vents/VentPlumeCalculator.js',
            'src/ecosystem/vents/VentChemistry.js',
            'src/ecosystem/vents/Vent.js',
            'src/ecosystem/vents/VentFactory.js',
            'src/ecosystem/vents/VentEventSystem.js',
            'src/ecosystem/vents/VentRenderer.js',
            'src/ecosystem/vents/VentActivityLogger.js',
            'src/ecosystem/vents/VentManager.js',
            'src/ecosystem/regeneration/GridRegeneration.js',
            'src/ecosystem/regeneration/OxygenRegeneration.js',
            'src/ecosystem/regeneration/PhosphorusRegeneration.js',
            'src/ecosystem/reservoirs/ReservoirSystem.js',
            'src/ecosystem/environment/GridSystem.js',
            'src/ecosystem/environment/StratificationManager.js',
            'src/ecosystem/environment/DynamicsManager.js',
            'src/ecosystem/environment/StatsManager.js',
            'src/ecosystem/environment/EnvironmentRenderer.js',
            'src/ecosystem/DiffusionSystem.js',
            'src/ecosystem/Environment.js',
            'src/entities/Entity.js',

            // Scenario Management Layer (New)
            'src/scenarios/ScenarioDefinition.js',
            'src/scenarios/ScenarioManager.js',
            'src/scenarios/ScenarioLibrary.js',

            // UI Components
            'src/ui/components/ConfigScreen.js',
            'src/ui/components/StatsPanel.js',
            'src/ui/components/CellInspector.js',
            'src/ui/components/MoleculeInspector.js',
            'src/ui/components/VentInspector.js',
            'src/ui/components/Legend.js',
            'src/ui/UIManager.js',

            // Core Game Loop
            'src/orchestrators/GameGovernor.js',
            'src/orchestrators/GameController.js',
            'src/orchestrators/Sketch.js',

            // Testing Layer (Runtime)
            'src/testing/TestManager.js',
            'src/testing/suites/VentTests.js',
            'src/testing/suites/MetabolismTests.js',
            'src/testing/suites/ScenarioTests.js',
            'src/testing/suites/PhysicsTests.js',
            'src/testing/suites/DatabaseTests.js',
            'src/testing/suites/GridTests.js',
            'src/testing/suites/BioChemistryTests.js'
        ];

        // Load all scripts with unique timestamp
        const v = Date.now();
        scripts.forEach(src => {
            document.write('<script src="' + src + '?v=' + v + '"><\/script>');
        });

        // Log timestamp for verification
        console.log('%c游댃 Scripts loaded with cache-busting timestamp: ' + v, 'color: #00ff00; font-weight: bold; font-size: 14px;');
        console.log('%c游늰 Load time: ' + new Date().toLocaleString(), 'color: #00ffff;');
    </script>
</body>

</html>