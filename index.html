<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cells - Simulador de Evolución</title>
    <!-- Error Handler -->
    <script>
        window.onerror = function (msg, url, lineNo, columnNo, error) {
            const message = [
                'Message: ' + msg,
                'URL: ' + url,
                'Line: ' + lineNo,
                'Column: ' + columnNo,
                'Error object: ' + JSON.stringify(error)
            ].join(' - ');

            // Create visible error banner
            const div = document.createElement('div');
            div.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; background: red; color: white; padding: 20px; z-index: 9999; font-family: monospace; font-size: 16px; white-space: pre-wrap; margin: 20px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.5);';
            div.textContent = 'CRITICAL ERROR: ' + message;
            document.body.appendChild(div);

            console.error('Window Error:', message);
            return false;
        };
        window.addEventListener('unhandledrejection', function (event) {
            const div = document.createElement('div');
            div.style.cssText = 'position: fixed; bottom: 0; left: 0; right: 0; background: orange; color: black; padding: 20px; z-index: 9999; font-family: monospace; font-size: 16px; white-space: pre-wrap; margin: 20px; border-radius: 8px;';
            div.textContent = 'UNHANDLED PROMISE: ' + event.reason;
            document.body.appendChild(div);
            console.error('Unhandled Rejection:', event.reason);
        });
    </script>
    <link rel="stylesheet" href="style.css?v=2">
    <link rel="icon" href="favicon.ico" type="image/x-icon">

    <!-- Librería Gráfica (p5.js) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
</head>

<body>
    <!-- Contenedor del Canvas (Juego) -->
    <div id="canvas-container"></div>

    <!-- Contenedor Raíz para la Interfaz (UI) -->
    <!-- Los componentes inyectarán su HTML aquí dentro -->
    <div id="ui-root"></div>

    <!-- ========================================== -->
    <!--            CARGA DE SCRIPTS                -->
    <!-- ========================================== -->

    <!-- 1. Configuración Global -->
    <!-- 1. Configuración Global -->
    <script>
        document.write('<script src="src/utils/Constants.js?v=' + Date.now() + '"><\/script>');
    </script>

    <!-- 2. Utilidades y Logs -->
    <!-- 2. Dynamic Script Loader (Cache Buster) -->
    <script>
        const scripts = [
            // Utils & Logging
            'src/logging/CircuitFilter.js',
            'src/logging/ReproductionIndexCalculator.js',
            'src/logging/DatabaseLogger.js',

            // DNA & Genetics
            'src/dna/DNAFactory.js',
            'src/dna/DNAMutator.js',
            'src/dna/GeneticDistance.js',

            // Organelles
            'src/organelles/Organelle.js',
            'src/organelles/Ribosome.js',
            'src/organelles/Flagellum.js',
            'src/organelles/Hydrogenosome.js',
            'src/organelles/ChemosyntheticEnzymes.js',

            // Cellular Systems
            'src/cellular_systems/FlagellaCosts.js',
            'src/cellular_systems/MetabolicCosts.js',
            'src/cellular_systems/ResourceConsumption.js',
            'src/cellular_systems/MembraneSystem.js',
            'src/cellular_systems/ColorSystem.js',
            'src/cellular_systems/OxygenTolerance.js',
            'src/cellular_systems/ThermalStress.js',
            'src/reproduction/ReproductionSystem.js',

            // Visualization
            'src/visualization/CellRenderer.js',
            'src/visualization/SpeciesNotifier.js',

            // Ecosystem
            'src/ecosystem/utils/GridUtils.js',
            'src/ecosystem/grids/ResourceGrids.js',
            'src/ecosystem/grids/ChemicalGrids.js',
            'src/ecosystem/grids/PhysicalGrids.js',
            'src/ecosystem/regeneration/GridRegeneration.js',
            'src/ecosystem/regeneration/OxygenRegeneration.js',
            'src/ecosystem/regeneration/PhosphorusRegeneration.js',
            'src/ecosystem/reservoirs/ReservoirSystem.js',
            'src/ecosystem/DiffusionSystem.js',
            'src/ecosystem/Environment.js',
            'src/core/Entity.js',

            // UI Components
            'src/ui/components/ConfigScreen.js',
            'src/ui/components/StatsPanel.js',
            'src/ui/components/CellInspector.js',
            'src/ui/components/Legend.js',
            'src/ui/UIManager.js',

            // Core Game Loop
            'src/core/GameGovernor.js',
            'src/core/GameController.js',
            'src/core/Sketch.js'
        ];

        // Load all scripts with unique timestamp
        const v = Date.now();
        scripts.forEach(src => {
            document.write('<script src="' + src + '?v=' + v + '"><\/script>');
        });
    </script>
</body>

</html>