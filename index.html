<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cells - Simulador de Evolución</title>
    <!-- Error Handler -->
    <script>
        window.onerror = function (msg, url, lineNo, columnNo, error) {
            const message = [
                'Message: ' + msg,
                'URL: ' + url,
                'Line: ' + lineNo,
                'Column: ' + columnNo,
                'Error object: ' + JSON.stringify(error)
            ].join(' - ');

            // Create visible error banner
            const div = document.createElement('div');
            div.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; background: red; color: white; padding: 20px; z-index: 9999; font-family: monospace; font-size: 16px; white-space: pre-wrap; margin: 20px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.5);';
            div.textContent = 'CRITICAL ERROR: ' + message;
            document.body.appendChild(div);

            console.error('Window Error:', message);
            return false;
        };
        window.addEventListener('unhandledrejection', function (event) {
            const div = document.createElement('div');
            div.style.cssText = 'position: fixed; bottom: 0; left: 0; right: 0; background: orange; color: black; padding: 20px; z-index: 9999; font-family: monospace; font-size: 16px; white-space: pre-wrap; margin: 20px; border-radius: 8px;';
            div.textContent = 'UNHANDLED PROMISE: ' + event.reason;
            document.body.appendChild(div);
            console.error('Unhandled Rejection:', event.reason);
        });
    </script>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="favicon.ico" type="image/x-icon">

    <!-- Librería Gráfica (p5.js) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
</head>

<body>
    <!-- Contenedor del Canvas (Juego) -->
    <div id="canvas-container"></div>

    <!-- Contenedor Raíz para la Interfaz (UI) -->
    <!-- Los componentes inyectarán su HTML aquí dentro -->
    <div id="ui-root"></div>

    <!-- ========================================== -->
    <!--            CARGA DE SCRIPTS                -->
    <!-- ========================================== -->

    <!-- 1. Configuración Global -->
    <script src="src/utils/Constants.js"></script>

    <!-- 2. Utilidades y Logs -->
    <script src="src/logging/CircuitFilter.js"></script>
    <script src="src/logging/ReproductionIndexCalculator.js"></script>
    <script src="src/logging/DatabaseLogger.js"></script> <!-- NEW: IndexedDB logging system -->

    <!-- 3. Núcleo Genético y Celular -->
    <script src="src/dna/DNAFactory.js"></script>
    <script src="src/dna/DNAMutator.js"></script>
    <script src="src/dna/GeneticDistance.js"></script>

    <!-- Organelles (Modular System) -->
    <script src="src/organelles/Organelle.js"></script>
    <script src="src/organelles/Ribosome.js"></script>
    <script src="src/organelles/Flagellum.js"></script>
    <script src="src/organelles/Hydrogenosome.js"></script>
    <script src="src/organelles/ChemosyntheticEnzymes.js"></script>

    <!-- Sistemas Celulares -->
    <script src="src/cellular_systems/FlagellaCosts.js"></script>
    <script src="src/cellular_systems/MetabolicCosts.js"></script>
    <script src="src/cellular_systems/ResourceConsumption.js"></script>
    <script src="src/cellular_systems/MembraneSystem.js"></script>
    <script src="src/cellular_systems/ColorSystem.js"></script>
    <script src="src/cellular_systems/OxygenTolerance.js"></script>
    <script src="src/cellular_systems/ThermalStress.js"></script>
    <!-- Reproducción -->
    <script src="src/reproduction/ReproductionSystem.js"></script>

    <!-- 4. Ecosistema y Visualización -->
    <script src="src/visualization/CellRenderer.js"></script>

    <script src="src/visualization/SpeciesNotifier.js"></script>
    <!-- <script src="src/visualization/DevelopmentMonitor.js"></script> REMOVED: File does not exist -->
    <!-- Grids y Regeneración -->
    <script src="src/ecosystem/utils/GridUtils.js"></script>
    <script src="src/ecosystem/grids/ResourceGrids.js"></script>
    <script src="src/ecosystem/grids/ChemicalGrids.js"></script>
    <script src="src/ecosystem/grids/PhysicalGrids.js"></script>
    <script src="src/ecosystem/regeneration/GridRegeneration.js"></script>
    <script src="src/ecosystem/regeneration/OxygenRegeneration.js"></script>
    <script src="src/ecosystem/regeneration/PhosphorusRegeneration.js"></script>
    <!-- Reservoir System (Infinite Pools) -->
    <script src="src/ecosystem/reservoirs/ReservoirSystem.js"></script>
    <script src="src/ecosystem/DiffusionSystem.js"></script> <!-- NEW: Diffusion Mechanics -->
    <script src="src/ecosystem/Environment.js"></script>
    <script src="src/core/Entity.js"></script>

    <!-- 5. Interfaz de Usuario (Componentes) -->
    <script src="src/ui/components/ConfigScreen.js"></script>
    <script src="src/ui/components/StatsPanel.js"></script>
    <script src="src/ui/components/Legend.js"></script>
    <script src="src/ui/UIManager.js"></script>

    <!-- 6. Control del Juego -->
    <script src="src/core/GameController.js"></script>
    <script src="src/core/Sketch.js"></script>
</body>

</html>